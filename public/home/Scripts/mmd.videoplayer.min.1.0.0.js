var enableInlineVideo=function(){"use strict";function e(e,t,n,i){function r(n){a=t(r,i),e(n-(d||n)),d=n}var a,d;return{start:function(){a||r(0)},stop:function(){n(a),a=null,d=0}}}function t(t){return e(t,requestAnimationFrame,cancelAnimationFrame)}function n(e,t,n,i){function r(t){Boolean(e[n])===Boolean(i)&&t.stopImmediatePropagation(),delete e[n]}return e.addEventListener(t,r,!1),r}function i(e,t,n,i){function r(){return n[t]}function a(e){n[t]=e}i&&a(e[t]),Object.defineProperty(e,t,{get:r,set:a})}function r(e,t,n){n.addEventListener(t,function(){return e.dispatchEvent(new Event(t))})}function a(e,t){Promise.resolve().then(function(){e.dispatchEvent(new Event(t))})}function d(e){var t=new Audio;return r(e,"play",t),r(e,"playing",t),r(e,"pause",t),t.crossOrigin=e.crossOrigin,t.src=e.src||e.currentSrc||"data:",t}function o(e,t,n){(m||0)+200<Date.now()&&(e[h]=!0,m=Date.now()),n||(e.currentTime=t),P[++T%3]=100*t|0}function u(e){return e.driver.currentTime>=e.video.duration}function s(e){var t=this;t.video.readyState>=t.video.HAVE_FUTURE_DATA?(t.hasAudio||(t.driver.currentTime=t.video.currentTime+e*t.video.playbackRate/1e3,t.video.loop&&u(t)&&(t.driver.currentTime=0)),o(t.video,t.driver.currentTime)):t.video.networkState===t.video.NETWORK_IDLE&&0===t.video.buffered.length&&t.video.load(),t.video.ended&&(delete t.video[h],t.video.pause(!0))}function c(){var e=this,t=e[g];return e.webkitDisplayingFullscreen?void e[b]():("data:"!==t.driver.src&&t.driver.src!==e.src&&(o(e,0,!0),t.driver.src=e.src),void(e.paused&&(t.paused=!1,0===e.buffered.length&&e.load(),t.driver.play(),t.updater.start(),t.hasAudio||(a(e,"play"),t.video.readyState>=t.video.HAVE_ENOUGH_DATA&&a(e,"playing")))))}function p(e){var t=this,n=t[g];n.driver.pause(),n.updater.stop(),t.webkitDisplayingFullscreen&&t[E](),n.paused&&!e||(n.paused=!0,n.hasAudio||a(t,"pause"),t.ended&&(t[h]=!0,a(t,"ended")))}function l(e,n){var i=e[g]={};i.paused=!0,i.hasAudio=n,i.video=e,i.updater=t(s.bind(i)),n?i.driver=d(e):(e.addEventListener("canplay",function(){e.paused||a(e,"playing")}),i.driver={src:e.src||e.currentSrc||"data:",muted:!0,paused:!0,pause:function(){i.driver.paused=!0},play:function(){i.driver.paused=!1,u(i)&&o(e,0)},get ended(){return u(i)}}),e.addEventListener("emptied",function(){var t=!i.driver.src||"data:"===i.driver.src;i.driver.src&&i.driver.src!==e.src&&(o(e,0,!0),i.driver.src=e.src,t?i.driver.play():i.updater.stop())},!1),e.addEventListener("webkitbeginfullscreen",function(){e.paused?n&&0===i.driver.buffered.length&&i.driver.load():(e.pause(),e[b]())}),n&&(e.addEventListener("webkitendfullscreen",function(){i.driver.currentTime=e.currentTime}),e.addEventListener("seeking",function(){P.indexOf(100*e.currentTime|0)<0&&(i.driver.currentTime=e.currentTime)}))}function f(e){var t=e[g];e[b]=e.play,e[E]=e.pause,e.play=c,e.pause=p,i(e,"paused",t.driver),i(e,"muted",t.driver,!0),i(e,"playbackRate",t.driver,!0),i(e,"ended",t.driver),i(e,"loop",t.driver,!0),n(e,"seeking"),n(e,"seeked"),n(e,"timeupdate",h,!1),n(e,"ended",h,!1)}function v(e,t){if(void 0===t&&(t={}),!e[g]){if(!t.everywhere){if(!y)return;if(!(t.iPad||t.ipad?/iPhone|iPod|iPad/:/iPhone|iPod/).test(navigator.userAgent))return}!e.paused&&e.webkitDisplayingFullscreen&&e.pause(),l(e,!e.muted),f(e),e.classList.add("IIV"),e.muted&&e.autoplay&&e.play(),/iPhone|iPod|iPad/.test(navigator.platform)||console.warn("iphone-inline-video is not guaranteed to work in emulated environments")}}var m,y="object"==typeof document&&"object-fit"in document.head.style&&!matchMedia("(-webkit-video-playable-inline)").matches,g="bfred-it:iphone-inline-video",h="bfred-it:iphone-inline-video:event",b="bfred-it:iphone-inline-video:nativeplay",E="bfred-it:iphone-inline-video:nativepause",P=[],T=0;return v}();!function(e){function t(e){function t(){S=!!e.loop&&e.loop,O=!!e.muted&&e.muted,P=e.onStart?e.onStart:void 0,T=e.onEnd?e.onEnd:void 0,w=e.timesParam?e.timesParam:void 0,A=e.onTimes?e.onTimes:void 0,L=!!e.tryMultipleVideoPlayAtTheSameTime&&e.tryMultipleVideoPlayAtTheSameTime,h("init","视频组件初始化"),w&&0==w.length||h("setTimesParam","设置时间节点"),E=e.src,b=e.videoElement,b.setAttribute("x-webkit-airplay","true"),b.setAttribute("airplay","allow"),b.setAttribute("webkit-playsinline","true"),b.setAttribute("playsinline","true"),b.addEventListener("canplay",a),b.addEventListener("canplaythrough",a),b.addEventListener("timeupdate",a),b.addEventListener("ended",a),b.addEventListener("abort",a),b.addEventListener("durationchange",a),b.addEventListener("emptied",a),b.addEventListener("error",a),b.addEventListener("loadeddata",a),b.addEventListener("loadedmetadata",a),b.addEventListener("loadstart",a),b.addEventListener("pause",a),b.addEventListener("play",a),b.addEventListener("playing",a),b.addEventListener("ratechange",a),b.addEventListener("stalled",a),b.addEventListener("suspend",a),b.addEventListener("volumechange",a),b.addEventListener("waiting",a),b.muted=O,n()}function n(){M=setInterval(function(){if("function"==typeof PTTSendClick){clearInterval(M);for(var e=0;e<D.length;e++)h(D[e][0],D[e][1])}},1e3)}function i(){V?(V=!1,b.src=E,p()&&(L?(F=!0,enableInlineVideo(b,{everywhere:!0})):"ios8"==v()||"iosOther"==v()?(F=!0,enableInlineVideo(b)):f()||l()||(F=!0,enableInlineVideo(b))),r()):h("play","播放")}function r(){w&&w.length>0&&s()}function a(e){switch("timeupdate"!=e.type,e.type){case"canplay":c(e);break;case"canplaythrough":c(e);break;case"timeupdate":c(e);break;case"ended":h("ended","播放完成"),T&&T(),I.loop&&I.replay()}}function d(){if(w)for(var e=0;e<w.length;e++)w[e].trigger||u(b.currentTime,w[e].time)&&(w[e].trigger=!0,o(e,w),A&&A(w[e].name))}function o(e,t){if(t&&0!=t.length)for(var n=0;n<t.length;n++)n!=e&&t[n].trigger&&(t[n].trigger=!1)}function u(e,t){e=(100*e>>0)/100;var n=!1,i=.03;return e<t+i&&e>t-15*i&&(n=!0),n}function s(){requestAnimFrame(s),d()}function c(e){"none"==b.style.display&&(b.style.display="block"),m()?"timeupdate"==e.type&&P&&R&&(R=!1,h("start","开始播放"),P()):P&&R&&(R=!1,h("start","开始播放"),P())}function p(){var e=navigator.userAgent,t=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);return t}function l(){var e=navigator.userAgent;return"MicroMessenger"==e.match(/MicroMessenger/i)}function f(){var e=navigator.userAgent;return"QQ/"==e.match(/QQ\//i)}function v(){var e=window.navigator.userAgent.toLowerCase(),t="";if(e.indexOf("iphone")>=0)return t=e.indexOf("os 10")>=0?"ios10s":e.indexOf("os 9")>=0?"ios9s":e.indexOf("os 8")>=0?"ios8":"iosOther"}function m(){var e=navigator.userAgent,t=e.indexOf("Android")>-1||e.indexOf("Adr")>-1;return t}function y(e){l()&&p()?"object"==typeof WeixinJSBridge?WeixinJSBridge.invoke("WeixinJSBridgeReady",{},function(t){e()}):document.addEventListener("WeixinJSBridgeReady",function(t){e()},!1):e()}function g(){var e=!1;return p()&&(l()||f())&&(e="ios8"!=v()||"iosOther"!=v()),e}function h(e,t){"function"==typeof PTTSendClick?PTTSendClick("mmdVideoPlayer",String(e),String(t)):D.push([e,t])}var b,E,P,T,A,w,L,O,k,S,j,x,M,R=!0,V=!0,F=!1,D=[],I=this;t(),Object.defineProperty(this,"muted",{get:function(){return O},set:function(e){O=e,b.muted=O}}),Object.defineProperty(this,"playbackRate",{get:function(){return k},set:function(e){k=e,b.playbackRate=k}}),Object.defineProperty(this,"currentTime",{get:function(){return b.currentTime}}),Object.defineProperty(this,"currentTimeAndPlay",{set:function(e){j=e,F?(b.pause(),b.currentTime=j,setTimeout(function(){I.play()},20)):(b.currentTime=j,I.play()),o(-1,w)}}),Object.defineProperty(this,"currentTimeAndPause",{set:function(e){x=e,b.pause(),b.currentTime=x,o(-1,w)}}),Object.defineProperty(this,"loop",{get:function(){return S},set:function(e){S=e}}),Object.defineProperty(this,"paused",{get:function(){return b.paused}}),Object.defineProperty(this,"duration",{get:function(){return b.duration}}),Object.defineProperty(this,"src",{get:function(){return E},set:function(e){I.pause(),E=e,R=!0,V=!0}}),Object.defineProperty(this,"timesParam",{get:function(){return w},set:function(e){w=e}}),Object.defineProperty(this,"poster",{get:function(){return b.poster},set:function(e){b.poster=e}}),Object.defineProperty(this,"isVideoCanAutoPlay",{get:function(){return g()}}),this.play=function(){i(),y(function(){F?b.play():b.play()})},this.pause=function(){h("pause","暂停"),b.pause()},this.replay=function(){h("replay","重播"),o(-1,w),b.playbackRate<0&&(b.playbackRate=1),this.currentTimeAndPlay=0}}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),e.VideoPlayer=t}(this.MMD=this.MMD||{});